{{ expect .systemip "ip" }}
{{ optional .isis_iid "0-31" }}
{{ optional .sid_idx "1-10000" }}
{{ optional .sid_start "19000-30000" }}
{{ optional .sid_end "19000-30000" }}

/configure system login-control idle-timeout 1440

/configure router interface "system"
    ipv4 primary address {{ ip .systemip }}
    ipv4 primary prefix-length {{ ipmask .systemip }}
    admin-state enable

/configure router
    autonomous-system {{ default 64500 .as_number }}
    {{- if .sid_idx }}
    mpls-labels sr-labels start {{ default 19000 .sid_start }} end {{ default 30000 .sid_end }}
    {{- end }}

/configure router isis {{ default 0 .isis_iid }}
    area-address 49.0000.0000.0000.0{{ default 0 .isis_iid }}
    level-capability 2
    level 2 wide-metrics-only
    #database-export igp-identifier {{ default 0 .isis_iid }} bgp-ls-identifier value {{ default 0 .isis_iid }}
    traffic-engineering
    advertise-router-capability area
    admin-state enable
    interface "system" admin-state enable
    {{- if .sid_idx }}
    interface "system" ipv4-node-sid index {{ .sid_idx }}
    segment-routing prefix-sid-range global
    segment-routing admin-state enable
    {{- end }}

/configure router rsvp
    admin-state enable
    interface system admin-state enable

/configure router mpls
    cspf-on-loose-hop
    interface system admin-state enable
    admin-state enable
    pce-report rsvp-te true
    pce-report sr-te true

/configure apply-groups ["baseport"]
/configure router bgp apply-groups ["basebgp"]

/configure groups {
    group "baseport" {
            port "<.*\/[0-9]+>" {
            # wanted to add this, but you really need the /1 context to exist
            # admin-state enable
            ethernet {
                mode hybrid
                encap-type dot1q
                lldp {
                    dest-mac nearest-bridge {
                        notification true
                        receive true
                        transmit true
                        tx-tlvs {
                            #port-desc true
                            sys-name true
                            #sys-desc true
                            sys-cap true
                        }
                        tx-mgmt-address system {
                            admin-state enable
                        }
                    }
                }
            }
        }
#        port "<.*c[0-9]+>" {
#            connector {
#                breakout c1-10g
#            }
#        }
    }
}
/configure groups {
    group "basebgp" {
        router "Base" {
            bgp {
                group "<.*>" {
                    admin-state enable
                    type internal
                    family {
                        vpn-ipv4 true
                        ipv4     true
                        vpn-ipv6 true
                        ipv6     true
                    }
                }
                neighbor "<.*>" {
                    admin-state enable
                    group "ibgp"
                }
            }
        }
    }
}
